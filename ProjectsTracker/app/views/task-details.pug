extends index

block main
    #banner.container
        .row
            .col-lg-5                
                    h1 #{title}
        .row
            .col-sm-1
                a.btn.btn-default(href='#')
                    span.glyphicon.glyphicon-edit
                    |  Edit
            .col-sm-1
            .col-sm-1
            .col-sm-1
                a.btn.btn-default(href='#')
                    |  Reassign
            .col-sm-1                    
            if (status == "Open" || status == "Reopened" || status == "Waiting For" || status == "Need More Info")
                .col-sm-4
                    .btn-group
                        a.btn.btn-default(href="/tasks/resolveTask/" + _id) Resolve
                        a.btn.btn-default.dropdown-toggle(href='#', data-toggle='dropdown', aria-expanded='false')
                            span.caret
                        ul.dropdown-menu
                            li
                                a(href="/tasks/resolveTask/" + _id) Resolve
                            li
                                a(href="/tasks/waitingForTask/" + _id) Waiting for
                            li
                                a(href="/tasks/duplicateTask/" + _id) Duplicate
                            li
                                a(href="/tasks/needMoreInfoTask/" + _id) Need more info
            if (status == "Resolved" || status == "Duplicate")
                .col-sm-4
                    .btn-group
                        a.btn.btn-default(href="/tasks/closeTask/" + _id) Close
                        a.btn.btn-default.dropdown-toggle(href='#', data-toggle='dropdown')
                            span.caret
                        ul.dropdown-menu
                            li
                                a(href="/tasks/closeTask/" + _id) Close
                            li
                                a(href="/tasks/reopenTask/" + _id) Reopen
        .row
            br
            .col-lg-4
                p Status: 
                    if (status === "Open")
                        span.label.label-default #{status}
                    else if (status === "Closed")
                        span.label.label-danger #{status}
                    else if (status === "Resolved")
                        span.label.label-success #{status}
                    else if (status === "Reopened")
                        span.label.label-default #{status}
                    else if (status === "Waiting For")
                        span.label.label-warning #{status}
                    else if (status === "Duplicate")
                        span.label.label-danger #{status}
                    else if (status === "Need More Info")
                        span.label.label-danger #{status}
            .col-lg-2
                p Priority: 
                    if (priority <=3)
                        span.label.label-danger #{priority}
                    else if (priority <= 7)
                        span.label.label-warning #{priority}
                    else
                        span.label.label-primary #{priority}
        .row
            .col-lg-5
                | Reporter: 
                p #{reporter}
            .col-lg-5
                | Created: 
                p #{createdDate.getDate()}-#{createdDate.getMonth() + 1 < 10? "0" + (createdDate.getMonth() + 1): createdDate.getMonth() + 1}-#{createdDate.getFullYear()} #{createdDate.getHours()}:#{createdDate.getMinutes() < 10? "0" + createdDate.getMinutes() : createdDate.getMinutes()}
        .row
            .col-lg-5
                | Assignee: 
                p #{assignee}    
            .col-lg-5
                | Last updated:
                p #{updatedDate.getDate()}-#{updatedDate.getMonth() + 1 < 10? "0" + (updatedDate.getMonth() + 1) : updatedDate.getMonth() + 1}-#{updatedDate.getFullYear()} #{updatedDate.getHours()}:#{updatedDate.getMinutes() < 10? "0" + updatedDate.getMinutes() : updatedDate.getMinutes()}
                .row
        .row
            .col-lg-10
                | Description:
                p #{description}
            aside.col-lg-6
                //.glyphicon.glyphicon-comment.btn.btn-default(data-toggle="collapse" data-target="#view-comments") Toggle Comments
                a.btn.btn-default(data-toggle="collapse" data-target="#view-comments")
                    span.glyphicon.glyphicon-comment
                    |  Toggle Comments
                .div#view-comments.collapse.well
                    if(comments.length > 0)
                            each comment in comments
                                div
                                    h6 By:
                                        a(href="/user/" + comment.username)  #{comment.username}
                                    p #{comment.content}
                                    h6 Posted on: #{comment.date.getDate()}-#{comment.date.getMonth() + 1 < 10? "0" + (comment.date.getMonth() + 1): comment.date.getMonth() + 1}-#{comment.date.getFullYear()} #{comment.date.getHours()}:#{comment.date.getMinutes() < 10? "0" + comment.date.getMinutes() : comment.date.getMinutes()}
                                hr
                    else
                        p No comments yet!
                    if(status !== "Closed" && status !== "Duplicate" && status !== "Resolved")
                        form(action="/tasks/" + _id + "/add-comment" method="post")
                            legend Add a comment
                            .form-group
                                textarea#tb-content.form-control(placeholder='Enter your comment', type='text', name="content" rows="3")
                                input(type='hidden', name='_csrf', value=_csrf)
                            input#add-comment-btn.btn.btn-success(type="submit" value="Add comment")
                    else
                       h6 You can not add comments on a #{status} task.
